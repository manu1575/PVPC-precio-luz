name: Descargar, procesar y enviar archivo

on:
  schedule:
    - cron: "21 22 * * *"  # Se ejecuta todos los días a las 22:00 UTC
  push:
    branches:
      - main

jobs:
  procesar-archivo:
    runs-on: ubuntu-latest

    steps:
    # 1. Clonar el repositorio
    - name: Clonar repositorio
      uses: actions/checkout@v3

    # 2. Instalar dependencias
    - name: Instalar dependencias
      run: |
        python -m pip install --upgrade pip
        pip install requests openpyxl pdfkit  # smtplib no se instala

    # 3. Descargar el archivo .xls
    - name: Descargar archivo .xls
      run: |
        python ./Descarga-REE.py  # Ejecuta tu script de descarga

    # 4. Convertir archivo .xls a .xlsx
    - name: Convertir .xls a .xlsx
      run: |
        python ./convertir_xls_a_xlsx.py  # Usar un script para convertir el archivo .xls a .xlsx

    # 5. Procesar datos y pegarlos en otro archivo .xlsx
    - name: Procesar datos y pegar en otro archivo
      run: |
        python ./procesar_datos.py  # Usar un script que procese los datos y los pegue en otro archivo .xlsx

    # 6. Generar archivo .pdf desde el archivo .xlsx
    - name: Generar archivo .pdf
      run: |
        python ./generar_pdf.py  # Usar un script para generar el PDF desde el archivo .xlsx

    # 7. Enviar el archivo .pdf por correo electrónico
    - name: Enviar email con archivo .pdf
      run: |
        python ./enviar_email.py  # Usar un script para enviar el archivo por correo

    # 8. Eliminar archivos temporales
    - name: Eliminar archivos temporales
      run: |
        rm -f /path/to/your/temp/files/*.xls
        rm -f /path/to/your/temp/files/*.xlsx
        rm -f /path/to/your/temp/files/*.pdf
